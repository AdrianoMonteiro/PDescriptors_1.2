#N canvas 190 0 886 694 10;
#X declare -lib iem_tab;
#X obj 15 333 hsl 595 15 0 1.51077e+006 0 0 offsetout offset empty
-2 -8 0 10 -228856 -1 -1 0 0;
#X obj 15 349 hsl 595 15 0 1.51077e+006 0 0 endout end empty -2 -8
0 10 -228856 -1 -1 0 0;
#N canvas 303 171 359 409 player 0;
#X obj 7 259 outlet~;
#X obj 25 -13 t b b b;
#X obj 4 222 dac~;
#X obj 25 -38 inlet;
#X obj 46 14 s rec;
#X obj 102 327 s guia;
#X msg 140 186 range 0 \$1;
#X obj 136 220 bang~;
#X obj 136 241 spigot;
#X obj 187 220 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X msg 59 212 1;
#X msg 106 195 0;
#X obj 26 163 tabplay~ chunk;
#X obj 87 7 arraysize chunk;
#X obj 128 293 f 0;
#X obj 177 293 + 64;
#X msg 74 190 0;
#X obj 196 -25 inlet;
#X obj 196 2 unpack f f;
#X obj 86 42 / 512;
#X obj 196 31 /;
#X floatatom 106 119 5 0 0 0 - - -;
#X floatatom 145 32 5 0 0 0 - - -;
#X msg 148 87 \; Onset resize \$1 \;;
#X connect 1 0 10 0;
#X connect 1 0 12 0;
#X connect 1 1 4 0;
#X connect 1 2 13 0;
#X connect 1 2 16 0;
#X connect 3 0 1 0;
#X connect 6 0 5 0;
#X connect 7 0 8 0;
#X connect 8 0 14 0;
#X connect 9 0 8 1;
#X connect 10 0 9 0;
#X connect 11 0 9 0;
#X connect 11 0 14 1;
#X connect 12 0 2 0;
#X connect 12 0 2 1;
#X connect 12 0 0 0;
#X connect 12 1 11 0;
#X connect 13 0 6 0;
#X connect 13 0 19 0;
#X connect 13 0 22 0;
#X connect 14 0 15 0;
#X connect 14 0 5 0;
#X connect 15 0 14 1;
#X connect 16 0 14 1;
#X connect 17 0 18 0;
#X connect 18 0 20 0;
#X connect 18 1 20 1;
#X connect 19 0 23 0;
#X connect 19 0 21 0;
#X connect 20 0 19 1;
#X restore 632 268 pd player;
#N canvas 824 193 237 263 rec 0;
#X obj 21 18 inlet;
#X obj 21 232 outlet;
#X obj 79 47 r rec;
#X obj 64 95 f 0;
#X obj 93 95 + 1;
#X msg 79 71 0;
#X obj 134 81 r Nblock;
#X obj 21 171 spigot;
#X floatatom 129 138 5 0 0 0 - - -;
#X obj 86 140 <=;
#X obj 64 170 spigot;
#X obj 134 105 - 0;
#X obj 21 47 t f b;
#X obj 32 207 tabwrite Onset;
#X connect 0 0 12 0;
#X connect 2 0 5 0;
#X connect 3 0 4 0;
#X connect 3 0 9 0;
#X connect 3 0 10 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 6 0 11 0;
#X connect 7 0 1 0;
#X connect 7 0 13 0;
#X connect 9 0 7 1;
#X connect 9 0 10 1;
#X connect 10 0 13 1;
#X connect 11 0 9 1;
#X connect 11 0 8 0;
#X connect 12 0 7 0;
#X connect 12 1 3 0;
#X restore 631 591 pd rec;
#X obj 741 310 tgl 15 0 empty empty feature_On/Off 17 7 0 10 -262144
-1 -1 0 1;
#X obj 632 249 bng 15 250 50 0 empty empty Play 17 7 0 10 -262144 -1
-1;
#X obj 11 379 cnv 15 600 140 empty empty empty 20 12 0 14 -191407 -66577
0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array chunk 1 float 3;
#A 0 -0.03302;
#X coords 0 1 1 -1 600 140 1;
#X restore 11 379 graph;
#X obj 13 193 cnv 15 600 140 empty empty empty 20 12 0 14 -228856 -66577
0;
#X obj 630 193 bng 15 250 50 0 empty empty openfile 17 7 0 10 -262144
-1 -1;
#N canvas 0 0 450 300 (subpatch) 0;
#X array buffer 1 float 2;
#X coords 0 1 1 -1 600 140 1;
#X restore 13 193 graph;
#X floatatom 724 375 5 0 0 1 Amplitude_Treshold - -;
#X obj 729 280 prepend set;
#X obj 784 12 dsp;
#X floatatom 784 33 5 0 0 0 - - -;
#X obj 14 537 hsl 595 140 0 409484 0 0 empty guia empty -2 -8 0 10
-257985 -258113 -1 0 1;
#N canvas 0 0 450 300 (subpatch) 0;
#X array Onset 1 float 1;
#A 0 0;
#X coords 0 1 1 0 600 140 1;
#X restore 10 537 graph;
#X text 727 248 FFT param;
#X floatatom 694 352 5 0 0 0 - - -;
#X obj 631 394 *;
#X obj 694 374 >;
#X floatatom 642 417 5 0 0 1 cutoff-Freq_(f) - -;
#X floatatom 652 436 5 0 0 1 pre-half-window_(a) - -;
#X floatatom 677 478 5 0 0 1 Median_coef_(md) - -;
#X floatatom 691 497 5 0 0 1 mean_coef_(mn) - -;
#X floatatom 738 552 5 0 0 1 BlockPeak_N-after_(k) - -;
#X obj 694 329 env~ 2048 1536;
#X text 561 141 h(n)= h(n-1)-(1/k) - select the first positive;
#X text 6 103 Z(n) = y(n) - MT(n);
#X text 131 104 --- apply filter;
#X text 6 64 y(n) = x(n)*(1/f) + y(n-1)/1+(1/f) -- iir lowpass filter
;
#X text 225 140 for h(n) => if [ peak(n) = 1 \, h(n)= 1] \;;
#X text 462 141 if [peak(n) = 0 \,;
#X text 517 84 -- Median + Mean adaptative Treshold Filter;
#X floatatom 663 458 5 0 0 1 post-half-window_(b) - -;
#X text 316 85 mn*mean( |y(n-a)| \, ... \, |y(n-b)|);
#X floatatom 706 515 5 0 0 1 fine_tune_(ft) - -;
#X text 5 85 MT(n) = ft + md*median ( |y(n-a)| \, ... \, |y(n-b)|)
+;
#X floatatom 721 533 5 0 0 1 LocalMax_half-window(mw) - -;
#N canvas 0 0 450 300 player 0;
#X obj 153 157 dac~;
#X obj 161 132 *~;
#X obj 162 86 line~;
#X msg 162 65 \$1 5;
#X obj 175 105 osc~ 1000;
#X obj 163 39 * 0.8;
#X obj 189 -9 inlet;
#X obj 183 16 t b f;
#X obj 159 -31 inlet;
#X connect 1 0 0 0;
#X connect 1 0 0 1;
#X connect 2 0 1 0;
#X connect 3 0 2 0;
#X connect 4 0 1 1;
#X connect 5 0 3 0;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
#X connect 7 1 5 1;
#X connect 8 0 5 0;
#X restore 631 624 pd player;
#X obj 682 605 tgl 15 0 empty empty Onset_Signal 17 7 0 10 -262144
-1 -1 0 0.8;
#X obj 631 309 possflux2~ 2048 4;
#X text 6 140 Peak(n) = LM(n) > 0 && h(n-1) <= 0 /;
#X text 6 122 LM(n) = if[ Z(n)> 0 && Z(n) >= Z(n-mw...n+mw) \, 1] else
0;
#X text 2 15 Based on (Brossier \, 2006);
#X text 4 43 PeakPicking Algorithm:;
#N canvas 504 97 586 216 sample 0;
#X obj 100 -88 soundfiler;
#X msg 100 -110 read -resize \$1 buffer;
#X obj 100 -130 openpanel;
#X obj 101 -26 s offset;
#X obj 159 -24 s end;
#X msg 100 -63 range 0 \$1;
#X obj 247 29 tab_copy buffer chunk;
#X obj 342 -155 r offsetout;
#X obj 262 -152 r endout;
#X obj 309 -91 -;
#X msg 329 -14 \; chunk resize \$1;
#X obj 101 -156 inlet;
#X obj 247 5 pack f 0 f;
#X obj 342 -126 t b f;
#X obj 305 -56 t b f f;
#X obj 247 -23 f;
#X obj 478 -97 s chunk;
#X obj 500 -65 s buffer;
#X msg 475 -125 resize 0;
#X obj 475 -150 closebang;
#X obj 477 -42 s Onset;
#X connect 0 0 5 0;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 5 0 3 0;
#X connect 5 0 4 0;
#X connect 7 0 13 0;
#X connect 8 0 9 0;
#X connect 9 0 14 0;
#X connect 11 0 2 0;
#X connect 12 0 6 0;
#X connect 13 0 9 0;
#X connect 13 1 9 1;
#X connect 13 1 15 1;
#X connect 14 0 15 0;
#X connect 14 1 12 2;
#X connect 14 2 10 0;
#X connect 15 0 12 0;
#X connect 18 0 16 0;
#X connect 18 0 17 0;
#X connect 18 0 20 0;
#X connect 19 0 18 0;
#X restore 630 216 pd sample;
#X msg 683 247 1024 2;
#X text 348 122 -- find the Local Maxima if it's greater than zero
;
#X text 2 -1 PEAK PICKING BY MEDIAN + MEAN ADPTATIVE THRESHOLD;
#X obj 631 570 peakpicking 2048 4;
#X connect 2 0 26 0;
#X connect 2 0 41 0;
#X connect 3 0 39 0;
#X connect 4 0 41 1;
#X connect 5 0 2 0;
#X connect 9 0 46 0;
#X connect 11 0 20 1;
#X connect 12 0 41 1;
#X connect 13 0 14 0;
#X connect 18 0 20 0;
#X connect 19 0 50 0;
#X connect 20 0 19 1;
#X connect 21 0 50 1;
#X connect 22 0 50 2;
#X connect 23 0 50 4;
#X connect 24 0 50 5;
#X connect 25 0 50 8;
#X connect 26 0 18 0;
#X connect 34 0 50 3;
#X connect 36 0 50 6;
#X connect 38 0 50 7;
#X connect 40 0 39 1;
#X connect 41 0 19 0;
#X connect 47 0 12 0;
#X connect 47 0 2 1;
#X connect 50 0 3 0;
